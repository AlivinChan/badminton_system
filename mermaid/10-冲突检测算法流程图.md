# 冲突检测算法流程图

```mermaid
flowchart TD
    Start([开始冲突检测]) --> Input[输入: courtId, timeSlot]
    Input --> GetBookings[获取所有预约<br/>db.getBookings]
    GetBookings --> InitLoop[初始化循环 i = 0]
    
    InitLoop --> CheckCount{i < bookingCount?}
    CheckCount -->|否| NoConflict[返回 false<br/>无冲突]
    CheckCount -->|是| GetBooking[获取预约 bookings[i]]
    
    GetBooking --> CheckNull{booking == null?}
    CheckNull -->|是| NextIter[下一个循环 i++]
    CheckNull -->|否| CheckCourtId{booking.courtId == courtId?}
    
    CheckCourtId -->|否| NextIter
    CheckCourtId -->|是| CheckState{booking.state == CANCELLED?}
    
    CheckState -->|是| NextIter
    CheckState -->|否| CheckOverlap[调用 TimeSlot.overlaps<br/>检查时间段重叠]
    
    CheckOverlap --> OverlapLogic{时间段重叠检测}
    
    subgraph "TimeSlot.overlaps 算法"
        OverlapLogic --> CheckDate{date1 == date2?}
        CheckDate -->|否| ReturnFalse[返回 false]
        CheckDate -->|是| CheckEnd1{end1 <= start2?}
        CheckEnd1 -->|是| ReturnFalse
        CheckEnd1 -->|否| CheckEnd2{end2 <= start1?}
        CheckEnd2 -->|是| ReturnFalse
        CheckEnd2 -->|否| ReturnTrue[返回 true<br/>时间段重叠]
    end
    
    CheckOverlap --> HasOverlap{overlaps返回true?}
    HasOverlap -->|是| HasConflict[返回 true<br/>有冲突]
    HasOverlap -->|否| NextIter
    
    NextIter --> CheckCount
    
    NoConflict --> End([结束])
    HasConflict --> End
    
    style Start fill:#e3f2fd
    style GetBookings fill:#fff3e0
    style CheckOverlap fill:#f3e5f5
    style OverlapLogic fill:#e8f5e9
    style HasConflict fill:#ffebee
    style NoConflict fill:#c8e6c9
    style End fill:#e3f2fd
```

